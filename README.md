This repo contains code for training/testing a CNN model for predicting gene expression from histone modifications and DNA sequences developed by Justin Sanders and Jordan Yang. For more information about our model and project, see our writeup.

The main code for our project is in histseq_model.py. The code is split int three main sections where the first loads the data, the second defines the model and training procedure, and the third calls the procedure to train the model and writes predictions to a file. Since our initial development, we have edited the first section to also read in the sequence data, we have changed architecture of the model defined in the second section, and added interpretation methods to the third section.

Within the code, the procedure train_model is where the model is defined and trained on the given data. This procedure takes an optional argument, testing_hyperparamaters, which indicates whether we are testing the effects of a change to the model (in which case we should run 5-fold cross validation to see how the validation loss behaves) or if we are wanting to make a final prediction to submit to Kaggle (in which case we want to train on all of the data). Currently, the code is set up to generate a submission to kaggle by calling train_model 3 times with testing_hyperparamaters=False, and averaging the results. If you wish to run an example of cross validation on our model, you can simply uncomment the call to train_model on line 337 where testing_hyperparamaters is set to True. At the end of the file there is also the code used to generate the histograms of gene expression and the code for running class based optimization and plotting the results. Additionally, after the model is trained the filter weights from the first CNN layer are saved to the file conv1_weights.npy. One can then use the procedure filter_weight_motifs() to print out a list of sequences generated by treating the filter weights as log-probabilities for each base pair. These sequences can then easily be turned into motifs by tools such as TomTom.
